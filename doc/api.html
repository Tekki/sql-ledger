<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>API - SQL-Ledger Documentation</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel="stylesheet" href="simple.css" />
</head>
<body>
<header id="title-block-header">
<h1 class="title">API - SQL-Ledger Documentation</h1>
</header>
<p><a href="index.html">SQL-Ledger Documentation</a> â–¶ API</p>
<h1 id="api">API</h1>
<h2 id="json-and-html-api">JSON and HTML API</h2>
<p>There are two ways to communicate programmatically with SQL-Ledger.
The first is to make requests to the API endpoint that returns a JSON
response. The second is to simulate a browser and imitate step by step
the actions of a user.</p>
<h2 id="prerequisites">Prerequisites</h2>
<p>In both approaches scripts that run in the SQL-Ledger infrastructure
are called.</p>
<p>The following code is written in Perl, but the same method can be
used in other languages, for example in Python or in PowerShell. It is
even possible to make simple API calls in the browser, with
<code>curl</code> or <code>wget</code>.</p>
<p>To run the examples, two, respectively three additional Perl modules
have to be installed with</p>
<pre><code>cpanm Mojolicious \
  Print::Colored  \
  HTML::Form      # only for the HTML API</code></pre>
<h2 id="authentication">Authentication</h2>
<h3 id="access-token-recommended">Access token (recommended)</h3>
<p>To get an access token, the first call has to be made to
<code>api.pl</code> with <code>username</code> and <code>password</code>
as parameters.</p>
<table>
<thead>
<tr class="header">
<th>parameter</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>action</td>
<td>'get_token'</td>
</tr>
<tr class="even">
<td>login</td>
<td>your username</td>
</tr>
<tr class="odd">
<td>password</td>
<td>your password</td>
</tr>
<tr class="even">
<td>totp</td>
<td>optional time-based one-time password</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb2"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">&quot;token&quot;</span><span class="fu">:</span> <span class="er">...</span> <span class="fu">}</span></span></code></pre></div>
<p>Returns a hash that contains the access token. The token has to be
used as <code>SL-Token</code> in the header of the requests. It is valid
until the session expires, this means until the same user logs in
again.</p>
<div class="sourceCode" id="cb3"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! /usr/bin/env perl</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">use</span> <span class="fu">Mojo::Base</span> <span class="ot">-s</span>trict;</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">use</span> <span class="fu">open</span> <span class="ot">&#39;</span><span class="ss">:std</span><span class="ot">&#39;</span>, <span class="ot">&#39;</span><span class="ss">:encoding(utf8)</span><span class="ot">&#39;</span>;</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="fu">use</span> <span class="fu">Mojo::UserAgent</span>;</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="fu">use</span> <span class="fu">Print::Colored</span> <span class="ot">&#39;</span><span class="ss">:all</span><span class="ot">&#39;</span>;</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">$sl_url</span> = prompt_input <span class="ot">&#39;</span><span class="ss">URL: </span><span class="ot">&#39;</span>;</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="fu">say</span> <span class="ot">&#39;</span><span class="ss">Login data for SQL-Ledger</span><span class="ot">&#39;</span>;</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">$sl_username</span> = prompt_input <span class="ot">&#39;</span><span class="ss">Username: </span><span class="ot">&#39;</span>;</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">$sl_password</span> = password_input <span class="ot">&#39;</span><span class="ss">Password: </span><span class="ot">&#39;</span>;</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">$ua</span>        = <span class="fu">Mojo::UserAgent</span>-&gt;new;</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">%sl_params</span> = (login =&gt; <span class="dt">$sl_username</span>, path =&gt; <span class="ot">&#39;</span><span class="ss">bin/mozilla</span><span class="ot">&#39;</span>,);</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">%search_params</span>;</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>    <span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/api.pl</span><span class="ot">&quot;</span>,</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>    form =&gt; {action =&gt; <span class="ot">&#39;</span><span class="ss">get_token</span><span class="ot">&#39;</span>, password =&gt; <span class="dt">$sl_password</span>, <span class="dt">%sl_params</span>}</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  )-&gt;result;</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">$json</span>      = <span class="dt">$res</span>-&gt;<span class="dt">json</span>;</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">$token</span>     = <span class="dt">$json</span>-&gt;{token};</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">%sl_header</span> = (<span class="ot">&#39;</span><span class="ss">SL-Token</span><span class="ot">&#39;</span> =&gt; <span class="dt">$token</span>);</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>say_info <span class="ot">&quot;</span><span class="st">Access token: </span><span class="dt">$token</span><span class="ot">&quot;</span>;</span></code></pre></div>
<p>SQL-Ledger always returns 200 as status code, so you probably want to
check the response for login errors in the body of the response.</p>
<div class="sourceCode" id="cb4"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="dt">$json</span>-&gt;{error}) {</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">die</span> color_error <span class="dt">$json</span>-&gt;{message};</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>In the following examples <code>%sl_header</code> with the token is
included as header in every request.</p>
<h3 id="login-with-every-request-alternative">Login with every request
(alternative)</h3>
<p>As an alternative it is possible to login with every request. This
may be useful if just a single request has to be made, but not
recommended for multiple requests.</p>
<div class="sourceCode" id="cb5"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">%sl_params</span> = (login =&gt; <span class="dt">$sl_username</span>, password =&gt; <span class="dt">$sl_password</span>, path =&gt; <span class="ot">&#39;</span><span class="ss">bin/mozilla</span><span class="ot">&#39;</span>,);</span></code></pre></div>
<p>For this, add the password to <code>%sl_params</code> and directly
call one of the following endpoints.</p>
<h2 id="json-api">JSON API</h2>
<p>Calls to the JSON API are made to <code>api.pl</code> with the
endpoint in the <code>action</code> parameter.</p>
<h3 id="list-accounts">List Accounts</h3>
<p>List all accounts from the chart of accounts.</p>
<table>
<thead>
<tr class="header">
<th>parameter</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>action</td>
<td>'list_accounts'</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">&quot;accounts&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="er">...</span> <span class="ot">]</span> <span class="fu">}</span></span></code></pre></div>
<p>Returns a hash with an array of all accounts.</p>
<div class="sourceCode" id="cb7"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/api.pl</span><span class="ot">&quot;</span>,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    \<span class="dt">%sl_header</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    form =&gt; {action =&gt; <span class="ot">&#39;</span><span class="ss">list_accounts</span><span class="ot">&#39;</span>, <span class="dt">%sl_params</span>}</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  )-&gt;result;</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="kw">my</span> <span class="dt">$accounts</span> = <span class="dt">$res</span>-&gt;<span class="dt">json</span>-&gt;{accounts}) {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  say_ok <span class="dt">@$accounts</span> . <span class="ot">&#39;</span><span class="ss"> accounts found</span><span class="ot">&#39;</span>;</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> <span class="kw">my</span> <span class="dt">$account</span> (<span class="dt">@$accounts</span>) {</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">printf</span> <span class="ot">&quot;</span><span class="wa">%-</span><span class="dt">6s</span><span class="st"> </span><span class="wa">%-</span><span class="dt">20s</span><span class="ch">\n</span><span class="ot">&quot;</span>, <span class="dt">$account</span>-&gt;{accno}, <span class="dt">$account</span>-&gt;{description};</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>  say_warn <span class="ot">&#39;</span><span class="ss">No accounts found</span><span class="ot">&#39;</span>;</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="search-customers">Search Customers</h3>
<p>Search customers using any of the parameters from
<code>Customers--Reports--Search</code>.</p>
<table>
<thead>
<tr class="header">
<th>parameter</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>action</td>
<td>'search_customer'</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb8"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">&quot;customers&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="er">...</span> <span class="ot">]</span> <span class="fu">}</span></span></code></pre></div>
<p>Returns a hash with an array of the customers that meet the search
criteria. If no customers are found the array is <code>null</code>.</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">%search_params</span> = (name =&gt; <span class="ot">&#39;</span><span class="ss">hans</span><span class="ot">&#39;</span>);  <span class="co"># search for name like &#39;hans&#39;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/api.pl</span><span class="ot">&quot;</span>,</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    \<span class="dt">%sl_header</span>,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    form =&gt; {action =&gt; <span class="ot">&#39;</span><span class="ss">search_customer</span><span class="ot">&#39;</span>, <span class="dt">%search_params</span>, <span class="dt">%sl_params</span>}</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  )-&gt;result;</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="kw">my</span> <span class="dt">$customers</span> = <span class="dt">$res</span>-&gt;<span class="dt">json</span>-&gt;{customers}) {</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>  say_ok <span class="dt">@$customers</span> . <span class="ot">&#39;</span><span class="ss"> customers found</span><span class="ot">&#39;</span>;</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> <span class="kw">my</span> <span class="dt">$customer</span> (<span class="dt">@$customers</span>) {</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">printf</span> <span class="ot">&quot;</span><span class="wa">%-</span><span class="dt">30</span><span class="st">.30s </span><span class="wa">%-</span><span class="dt">10s</span><span class="st"> </span><span class="dt">%s</span><span class="ch">\n</span><span class="ot">&quot;</span>, <span class="dt">$customer</span>-&gt;{name}, <span class="dt">$customer</span>-&gt;{typeofcontact}, <span class="dt">$customer</span>-&gt;{email};</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  say_warn <span class="ot">&#39;</span><span class="ss">No customers found</span><span class="ot">&#39;</span>;</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="customer-details">Customer Details</h3>
<p>Load all details of a customer.</p>
<table>
<thead>
<tr class="header">
<th>parameter</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>action</td>
<td>'customer_details'</td>
</tr>
<tr class="even">
<td>id</td>
<td>a valid customer ID</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb10"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">...</span><span class="fu">,</span> <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="er">...</span><span class="fu">,</span> <span class="er">...</span> <span class="fu">}</span></span></code></pre></div>
<p>Returns a hash containing all the values for this customer. If no ID
is provided or if it does not exists the hash just contains some default
values.</p>
<div class="sourceCode" id="cb11"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="dt">%search_params</span> = (id =&gt; <span class="dt">$customer_id</span>);  <span class="co"># with a valid ID</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/api.pl</span><span class="ot">&quot;</span>,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    \<span class="dt">%sl_header</span>,</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    form =&gt; {action =&gt; <span class="ot">&#39;</span><span class="ss">customer_details</span><span class="ot">&#39;</span>, <span class="dt">%search_params</span>, <span class="dt">%sl_params</span>}</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  )-&gt;result;</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>say_info dumper <span class="dt">$res</span>-&gt;<span class="dt">json</span>;</span></code></pre></div>
<h3 id="search-order">Search Order</h3>
<p>Search for a sales or purchase order using any of the parameters from
<code>Order Entry--Reports--Sales Orders</code>.</p>
<table>
<thead>
<tr class="header">
<th>parameter</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>action</td>
<td>'search_order'</td>
</tr>
<tr class="even">
<td>open</td>
<td>default '1'</td>
</tr>
<tr class="odd">
<td>type</td>
<td>default 'sales_order', alternative 'purchase_order'</td>
</tr>
<tr class="even">
<td>vc</td>
<td>default 'customer', alternative 'vendor'</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb12"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">&quot;orders&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="er">...</span> <span class="ot">]</span> <span class="fu">}</span></span></code></pre></div>
<p>Returns a hash with an array of the orders that meet the search
criteria. If no orders are found the array is <code>null</code>.</p>
<div class="sourceCode" id="cb13"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list all closed orders from 2020</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="dt">%search_params</span> = (</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  closed =&gt; <span class="dv">1</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  transdatefrom =&gt; <span class="ot">&#39;</span><span class="ss">2020-01-01</span><span class="ot">&#39;</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  transdateto =&gt; <span class="ot">&#39;</span><span class="ss">2020-12-31</span><span class="ot">&#39;</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/api.pl</span><span class="ot">&quot;</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    \<span class="dt">%sl_header</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    form =&gt; {action =&gt; <span class="ot">&#39;</span><span class="ss">search_order</span><span class="ot">&#39;</span>, <span class="dt">%search_params</span>, <span class="dt">%sl_params</span>}</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>  )-&gt;result;</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="kw">my</span> <span class="dt">$orders</span> = <span class="dt">$res</span>-&gt;<span class="dt">json</span>-&gt;{orders}) {</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>  say_ok <span class="dt">@$orders</span> . <span class="ot">&#39;</span><span class="ss"> orders found</span><span class="ot">&#39;</span>;</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> <span class="kw">my</span> <span class="dt">$order</span> (<span class="dt">@$orders</span>) {</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">printf</span> <span class="ot">&quot;</span><span class="wa">%-</span><span class="dt">6s</span><span class="st"> </span><span class="wa">%-</span><span class="dt">10s</span><span class="st"> </span><span class="dt">%s</span><span class="ch">\n</span><span class="ot">&quot;</span>, <span class="dt">$order</span>-&gt;{ordnumber}, <span class="dt">$order</span>-&gt;{transdate}, <span class="dt">$order</span>-&gt;{name};</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>  say_warn <span class="ot">&#39;</span><span class="ss">No orders found</span><span class="ot">&#39;</span>;</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="search-transaction">Search Transaction</h3>
<p>Search for transactions using any of the parameters from
<code>AR--Reports--Transactions</code> or
<code>AR--Reports--Outstanding</code>.</p>
<table>
<thead>
<tr class="header">
<th>parameter</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>action</td>
<td>'search_transaction'</td>
</tr>
<tr class="even">
<td>open</td>
<td>default '1' if <code>outstanding</code> is not set</td>
</tr>
<tr class="odd">
<td>summary</td>
<td>default '1'</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb14"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">&quot;transactions&quot;</span><span class="fu">:</span> <span class="ot">[</span> <span class="er">...</span> <span class="ot">]</span> <span class="fu">}</span></span></code></pre></div>
<p>Returns a hash with an array of the transactions that meet the search
criteria. If none are found the array is <code>null</code>.</p>
<div class="sourceCode" id="cb15"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># list open invoices from December 31, 2020</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">%search_params</span> = (</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  outstanding =&gt; <span class="dv">1</span>,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  transdateto =&gt; <span class="ot">&#39;</span><span class="ss">2020-12-31</span><span class="ot">&#39;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/api.pl</span><span class="ot">&quot;</span>,</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    \<span class="dt">%sl_header</span>,</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    form =&gt; {action =&gt; <span class="ot">&#39;</span><span class="ss">search_transaction</span><span class="ot">&#39;</span>, <span class="dt">%search_params</span>, <span class="dt">%sl_params</span>}</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>  )-&gt;result;</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="kw">my</span> <span class="dt">$transactions</span> = <span class="dt">$res</span>-&gt;<span class="dt">json</span>-&gt;{transactions}) {</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  say_ok <span class="dt">@$transactions</span> . <span class="ot">&#39;</span><span class="ss"> transactions found</span><span class="ot">&#39;</span>;</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> <span class="kw">my</span> <span class="dt">$transaction</span> (<span class="dt">@$transactions</span>) {</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">printf</span> <span class="ot">&quot;</span><span class="wa">%-</span><span class="dt">6s</span><span class="st"> </span><span class="wa">%-</span><span class="dt">10s</span><span class="st"> </span><span class="wa">%-</span><span class="dt">30s</span><span class="st"> </span><span class="dt">%9</span><span class="st">.2f </span><span class="wa">%-</span><span class="dt">10s</span><span class="ch">\n</span><span class="ot">&quot;</span>, <span class="dt">$transaction</span>-&gt;{invnumber}, <span class="dt">$transaction</span>-&gt;{transdate},</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>      <span class="dt">$transaction</span>-&gt;{name}, <span class="dt">$transaction</span>-&gt;{amount}, <span class="dt">$transaction</span>-&gt;{datepaid} || <span class="ot">&#39;&#39;</span>;</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>  say_warn <span class="ot">&#39;</span><span class="ss">No transactions found</span><span class="ot">&#39;</span>;</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="invoice-details">Invoice Details</h3>
<p>Load all the details of a sales invoice.</p>
<table>
<thead>
<tr class="header">
<th>parameter</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>action</td>
<td>'invoice_details'</td>
</tr>
<tr class="even">
<td>id</td>
<td>valid ID of a sales invoice</td>
</tr>
<tr class="odd">
<td>dcn</td>
<td>DCN</td>
</tr>
<tr class="even">
<td>invnumber</td>
<td>invoice number</td>
</tr>
<tr class="odd">
<td>waybill</td>
<td>content of field <code>waybill</code></td>
</tr>
</tbody>
</table>
<p>Only the first of <code>id</code>, <code>dcn</code>,
<code>invnumber</code>, or <code>waybill</code> is taken into account
and the most recent invoice that meets the criteria is returned.</p>
<div class="sourceCode" id="cb16"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">&quot;id&quot;</span><span class="fu">:</span> <span class="er">...</span><span class="fu">,</span> <span class="dt">&quot;invnumber&quot;</span><span class="fu">:</span> <span class="er">...</span><span class="fu">,</span> <span class="er">...</span> <span class="fu">}</span></span></code></pre></div>
<p>Returns a hash containing all the values for the invoice. If none is
found the hash contains no ID and just some default values.</p>
<div class="sourceCode" id="cb17"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="dt">%search_params</span> = (dcn =&gt; <span class="dt">$dcn</span>);  <span class="co"># a valid DCN</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/api.pl</span><span class="ot">&quot;</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    \<span class="dt">%sl_header</span>,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    form =&gt; {action =&gt; <span class="ot">&#39;</span><span class="ss">invoice_details</span><span class="ot">&#39;</span>, <span class="dt">%search_params</span>, <span class="dt">%sl_params</span>}</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  )-&gt;result;</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="dt">$res</span>-&gt;<span class="dt">json</span>-&gt;{id}) {</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>  say_info dumper <span class="dt">$res</span>-&gt;<span class="dt">json</span>;</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  say_warn <span class="ot">&#39;</span><span class="ss">No invoice found</span><span class="ot">&#39;</span>;</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="add-payment">Add Payment</h3>
<p>Add a payment to a sales invoice.</p>
<table>
<thead>
<tr class="header">
<th>parameter</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>action</td>
<td>'add_payment'</td>
</tr>
<tr class="even">
<td>amount</td>
<td>amount paid</td>
</tr>
<tr class="odd">
<td>datepaid</td>
<td>payment date</td>
</tr>
<tr class="even">
<td>currency</td>
<td>(optional)</td>
</tr>
<tr class="odd">
<td>exchangerate</td>
<td>required if <code>currency</code> is provided</td>
</tr>
<tr class="even">
<td>memo</td>
<td>(optional)</td>
</tr>
<tr class="odd">
<td>paymentaccount</td>
<td>account number for the payment</td>
</tr>
<tr class="even">
<td>paymentmethod</td>
<td>(optional)</td>
</tr>
<tr class="odd">
<td>source</td>
<td>(optional)</td>
</tr>
</tbody>
</table>
<p>The invoice has to be identified using one of <code>id</code>,
<code>dcn</code>, <code>invnumber</code>, or <code>waybill</code>.</p>
<div class="sourceCode" id="cb18"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">&quot;result&quot;</span><span class="fu">:</span> <span class="st">&quot;success&quot;</span> <span class="fu">}</span></span></code></pre></div>
<p>Returns success or error.</p>
<div class="sourceCode" id="cb19"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">%payment_params</span> = (</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  amount         =&gt; <span class="dt">$amount</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  dcn            =&gt; <span class="dt">$dcn</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  datepaid       =&gt; <span class="dt">$date</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  paymentaccount =&gt; <span class="dt">$account</span>,</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/api.pl</span><span class="ot">&quot;</span>,</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    \<span class="dt">%sl_header</span>,</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    form =&gt; {action =&gt; <span class="ot">&#39;</span><span class="ss">add_payment</span><span class="ot">&#39;</span>, <span class="dt">%payment_params</span>, <span class="dt">%sl_params</span>}</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  )-&gt;result;</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="dt">$res</span>-&gt;<span class="dt">json</span>-&gt;{result} <span class="ot">eq</span> <span class="ot">&#39;</span><span class="ss">success</span><span class="ot">&#39;</span>) {</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>  say_ok <span class="ot">&#39;</span><span class="ss">Payment added.</span><span class="ot">&#39;</span>;</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>  say_error <span class="ot">&#39;</span><span class="ss">Error, payment not added!</span><span class="ot">&#39;</span>;</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h3 id="add-reference">Add Reference</h3>
<p>Add a reference to an external document to a sales invoice.</p>
<table>
<thead>
<tr class="header">
<th>parameter</th>
<th>value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>action</td>
<td>'add_reference'</td>
</tr>
<tr class="even">
<td>referencecode</td>
<td>code of the reference to create the link</td>
</tr>
<tr class="odd">
<td>referencedescription</td>
<td>description of the reference</td>
</tr>
</tbody>
</table>
<p>The invoice has to be identified using one of <code>id</code>,
<code>dcn</code>, <code>invnumber</code>, or <code>waybill</code>.</p>
<div class="sourceCode" id="cb20"><pre
class="sourceCode json"><code class="sourceCode json"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span> <span class="dt">&quot;result&quot;</span><span class="fu">:</span> <span class="st">&quot;success&quot;</span> <span class="fu">}</span></span></code></pre></div>
<p>Returns success or error.</p>
<div class="sourceCode" id="cb21"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">%reference_params</span> = (</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>  dcn                  =&gt; <span class="dt">$dcn</span>,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  referencecode        =&gt; <span class="dt">$code</span>,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  referencedescription =&gt; <span class="dt">$description</span>,</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>);</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/api.pl</span><span class="ot">&quot;</span>,</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    \<span class="dt">%sl_header</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    form =&gt; {action =&gt; <span class="ot">&#39;</span><span class="ss">add_reference</span><span class="ot">&#39;</span>, <span class="dt">%reference_params</span>, <span class="dt">%sl_params</span>}</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  )-&gt;result;</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a><span class="kw">if</span> (<span class="dt">$res</span>-&gt;<span class="dt">json</span>-&gt;{result} <span class="ot">eq</span> <span class="ot">&#39;</span><span class="ss">success</span><span class="ot">&#39;</span>) {</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  say_ok <span class="ot">&#39;</span><span class="ss">Reference added.</span><span class="ot">&#39;</span>;</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>} <span class="kw">else</span> {</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>  say_error <span class="ot">&#39;</span><span class="ss">Error, reference not added!</span><span class="ot">&#39;</span>;</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<h2 id="html-api">HTML API</h2>
<p>This is not a real API, we just reproduce what a user is doing when
he works with SQL-Ledger in a browser.</p>
<h3 id="preparation">Preparation</h3>
<p>To get a consistent behavior of the screens, the Drop-down Limit in
the Preferences of the user should be set to zero. As already mentioned,
we need more Perl modules and the header of the script looks like
this:</p>
<div class="sourceCode" id="cb22"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! /usr/bin/env perl</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">use</span> <span class="fu">Mojo::Base</span> <span class="ot">-s</span>trict;</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">use</span> <span class="fu">open</span> <span class="ot">&#39;</span><span class="ss">:std</span><span class="ot">&#39;</span>, <span class="ot">&#39;</span><span class="ss">:encoding(utf8)</span><span class="ot">&#39;</span>;</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="fu">use</span> <span class="fu">HTML::Form</span>;</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">use</span> <span class="fu">Mojo::Util</span> <span class="ot">&#39;</span><span class="ss">decode</span><span class="ot">&#39;</span>;</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="fu">use</span> <span class="fu">Mojo::UserAgent</span>;</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">use</span> <span class="fu">Print::Colored</span> <span class="ot">&#39;</span><span class="ss">:all</span><span class="ot">&#39;</span>;</span></code></pre></div>
<h3 id="add-an-invoice">Add an invoice</h3>
<p>As an example we create an invoice for customer with number 1109. We
start with creating variables for the content of the invoice.</p>
<div class="sourceCode" id="cb23"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># content of the invoice</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">$customernumber</span> = <span class="dv">1109</span>;</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">$description</span>    = <span class="ot">&#39;</span><span class="ss">Generated Invoice</span><span class="ot">&#39;</span>;</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">@rows</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>  = ({partnumber =&gt; <span class="dv">300016</span>, qty =&gt; <span class="dv">5</span>}, {partnumber =&gt; <span class="dv">300011</span>, qty =&gt; <span class="dv">2</span>}, {partnumber =&gt; <span class="dv">300005</span>},);</span></code></pre></div>
<p>The first step for a user would be to click on
<code>AR--Sales Invoice</code> in the menu. In the script we simulate
this with a call to <code>is.pl</code>.</p>
<div class="sourceCode" id="cb24"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># open page AR--Sales Invoice</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    <span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/is.pl</span><span class="ot">&quot;</span>,</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    \<span class="dt">%sl_header</span>,</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>    form =&gt; {action =&gt; <span class="ot">&#39;</span><span class="ss">add</span><span class="ot">&#39;</span>,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>    type =&gt; <span class="ot">&#39;</span><span class="ss">invoice</span><span class="ot">&#39;</span>, <span class="dt">%sl_params</span>}</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  )-&gt;result;</span></code></pre></div>
<p>Next he would choose the customer and add the description.</p>
<div class="sourceCode" id="cb25"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add customer number and description</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="dt">%form</span>                 = <span class="fu">HTML::Form</span>-&gt;parse(decode(<span class="dt">$charset</span>, <span class="dt">$res</span>-&gt;<span class="dt">body</span>), <span class="dt">%parse_params</span>)-&gt;form;</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="dt">$form</span>{customernumber} = <span class="dt">$customernumber</span>;</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="dt">$form</span>{description}    = <span class="dt">$description</span>;</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="dt">$form</span>{action} = <span class="ot">&#39;</span><span class="ss">update</span><span class="ot">&#39;</span>;</span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(<span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/is.pl</span><span class="ot">&quot;</span>, \<span class="dt">%sl_header</span>, form =&gt; \<span class="dt">%form</span>)-&gt;result;</span></code></pre></div>
<p>Then he would add the part numbers and quantities to the rows and
press the <code>Update</code> button after each row.</p>
<div class="sourceCode" id="cb26"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add rows</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">my</span> <span class="dt">$i</span>;</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="kw">for</span> <span class="kw">my</span> <span class="dt">$row</span> (<span class="dt">@rows</span>) {</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="dt">$i</span>++;</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>  <span class="dt">%form</span> = <span class="fu">HTML::Form</span>-&gt;parse(decode(<span class="dt">$charset</span>, <span class="dt">$res</span>-&gt;<span class="dt">body</span>), <span class="dt">%parse_params</span>)-&gt;form;</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">for</span> (<span class="fu">keys</span> %<span class="dt">$row</span>) {</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">$form</span>{<span class="ot">&quot;</span><span class="dt">${_}_$i</span><span class="ot">&quot;</span>} = <span class="dt">$row</span>-&gt;{<span class="wa">$_</span>};</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>  <span class="dt">$form</span>{action} = <span class="ot">&#39;</span><span class="ss">update</span><span class="ot">&#39;</span>;</span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>  <span class="dt">$res</span> = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(<span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/is.pl</span><span class="ot">&quot;</span>, \<span class="dt">%sl_header</span>, form =&gt; \<span class="dt">%form</span>)-&gt;result;</span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>At the end, the user would press the <code>Post</code> button.</p>
<div class="sourceCode" id="cb27"><pre
class="sourceCode perl"><code class="sourceCode perl"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># post invoice</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="dt">%form</span>         = <span class="fu">HTML::Form</span>-&gt;parse(decode(<span class="dt">$charset</span>, <span class="dt">$res</span>-&gt;<span class="dt">body</span>), <span class="dt">%parse_params</span>)-&gt;form;</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a><span class="dt">$form</span>{action} = <span class="ot">&#39;</span><span class="ss">post</span><span class="ot">&#39;</span>;</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="dt">$res</span>          = <span class="dt">$ua</span>-&gt;<span class="dt">post</span>(<span class="ot">&quot;</span><span class="dt">$sl_url</span><span class="st">/is.pl</span><span class="ot">&quot;</span>, \<span class="dt">%sl_header</span>, form =&gt; \<span class="dt">%form</span>)-&gt;result;</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>say_ok <span class="ot">&#39;</span><span class="ss">Invoice posted.</span><span class="ot">&#39;</span>;</span></code></pre></div>
<p>Now the new invoice is created and it appears at the top of the list
of this user's recently used objects.</p>
</body>
</html>
